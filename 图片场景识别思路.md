
## 图片场景分裂思路：

1、对于训练集中的不同类别的数据：构建如下的prompt模板
```python
### Qwen-vl-72b模型解释原因的prompt设计
template = '''
picture_description = "这是一个有关"
# 你是一个电商领域识图专家,可以理解消费者上传的软件截图或实物拍摄图。 

# 图片属于如下的分类标签中的一类:
    [\"实物拍摄(含售后)\",\"商品分类选项\",\"商品头图\",\"商品详情页截图\",\"下单过程中出现异常（显示购买失败浮窗）\",\"订单详情页面\",\"支付页面\",\"评论区截图页面\",\"物流页面-物流列表页面\",\"物流页面-物流跟踪页面\",\"物流页面-物流异常页面\",\"退款页面\",\"退货页面\",\"换货页面\",\"购物车页面\",\"店铺页面\",\"活动页面\",\"优惠券领取页面\",\"账单/账户页面\",\"投诉举报页面\",\"平台介入页面\",\"外部APP截图\",\"其他类别图片\"]

# 各个标签的定义如下：
    "实物拍摄(含售后)":用户用相机实拍的照片，包括用户售后的照片（损坏、缺失、与描述不符），或者其他用相机实拍的图片。
    "商品分类选项":商品颜色、规格选项。
    "商品头图":商品首页大图。
    "商品详情页截图":可能出现在商品详情页各个部分的截图。
    "下单过程中出现异常（显示购买失败浮窗）":下单过程中出现异常（显示购买失败浮窗）的截图。
    "订单详情页面":呈现出完整订单信息的订单页面。
    "支付页面":包含支付方式选择、支付成功的页面。
    "评论区截图页面":在淘宝APP内或其他APP内的评论区截图。
    "物流页面-物流列表页面":呈现出两个以上物流信息的页面。
    "物流页面-物流跟踪页面":呈现出物流运输路径的页面。
    "物流页面-物流异常页面":包含物流异常信息的页面。
    "退款页面":含有退款信息的页面。
    "退货页面":含有退货信息的页面。
    "换货页面":含有换货信息的页面。
    "购物车页面":淘宝购物车页面的列表图或金额计算图。
    "店铺页面":店铺首页截图。
    "活动页面":活动截图。
    "优惠券领取页面":店铺首页或活动页中领取优惠券的截图。
    "账单/账户页面":包含交易明细列表、资产列表、卡券红包列表等。
    "投诉举报页面":	投诉或举报页面。
    "实物拍摄(含售后)":用户用相机实拍的照片，包括用户售后的照片（损坏、缺失、与描述不符），或者其他用相机实拍的图片。
    "平台介入页面":平台客服介入处理的截图。
    "外部APP截图":各种非淘宝、菜鸟APP的截图，包括京东、拼多多、短信、手机系统截图。
    "其他类别图片":拿不准的其他图片。

# 现在请根据图片中的信息,标签的定义逐步解释图片的分类标签是"{}"的原因。
'''
```
  "{}"替换为对应的类，比如商品头图：
调用Qwen-vl-72b生成的解释原因，把这个作为训练集的output的初始状态。

2、人工手动调整：
需要继续根据不同的类别，将Qwen-vl-72b模型的原因解释，规范化。比如说，对于商品分类选项，对于模型输出的原因解释手动调整后，统一的output的模板可能长这样(这样设计是希望能引导模型思考)：
```python
### 商品分类选项output模板
response='''这是一张{xx}的购买页面的截图,主要显示了可以选择的商品的规格：xxxx，颜色:xxxx。 由于图片中主要信息符合类别"商品分类选项"的定义："图片中显示商品颜色、规格选项",因此 标签为: "商品分类选项".'''
```
这个模板会作为训练集的output。output中含有这个类别的主要特征，以及一个逻辑推理过程，此外格式是固定的，这是xxx的图片，主要显示了xxx，由于符合xxx的定义，因此，标签为："xxx".


3、设计训练集的prompt模板，原训练集的prompt没有对类别的定义做一个描述，为了让模型能得到更多信息，在prompt中加入了各个类的定义，也为了能和我们上面生成的response相对应起来，因为response中提及到了标签的定义（此外删除了两个不存在训练样本的标签）。

```python
### Qwen-vl-72b模型解释原因的prompt设计
template = '''
# 你是一个电商领域识图专家,可以理解消费者上传的软件截图或实物拍摄图。 

# 上传的图片属于如下的分类标签中的一类:
    [\"实物拍摄(含售后)\",\"商品分类选项\",\"商品头图\",\"商品详情页截图\",\"下单过程中出现异常（显示购买失败浮窗）\",\"订单详情页面\",\"支付页面\",\"评论区截图页面\",\"物流页面-物流列表页面\",\"物流页面-物流跟踪页面\",\"物流页面-物流异常页面\",\"退款页面\",\"退货页面\",\"换货页面\",\"购物车页面\",\"店铺页面\",\"活动页面\",\"优惠券领取页面\",\"账单/账户页面\",\"投诉举报页面\",\"平台介入页面\",\"外部APP截图\",\"其他类别图片\"]

# 各个标签的定义如下：
    "实物拍摄(含售后)":用户用相机实拍的照片，包括用户售后的照片（损坏、缺失、与描述不符），或者其他用相机实拍的图片。
    "商品分类选项":商品颜色、规格选项。
    "商品头图":商品首页大图。
    "商品详情页截图":可能出现在商品详情页各个部分的截图。
    "下单过程中出现异常（显示购买失败浮窗）":下单过程中出现异常（显示购买失败浮窗）的截图。
    "订单详情页面":呈现出完整订单信息的订单页面。
    "支付页面":包含支付方式选择、支付成功的页面。
    "评论区截图页面":在淘宝APP内或其他APP内的评论区截图。
    "物流页面-物流列表页面":呈现出两个以上物流信息的页面。
    "物流页面-物流跟踪页面":呈现出物流运输路径的页面。
    "物流页面-物流异常页面":包含物流异常信息的页面。
    "退款页面":含有退款信息的页面。
    "退货页面":含有退货信息的页面。
    "换货页面":含有换货信息的页面。
    "购物车页面":淘宝购物车页面的列表图或金额计算图。
    "店铺页面":店铺首页截图。
    "活动页面":活动截图。
    "优惠券领取页面":店铺首页或活动页中领取优惠券的截图。
    "账单/账户页面":包含交易明细列表、资产列表、卡券红包列表等。
    "投诉举报页面":	投诉或举报页面。
    "实物拍摄(含售后)":用户用相机实拍的照片，包括用户售后的照片（损坏、缺失、与描述不符），或者其他用相机实拍的图片。
    "平台介入页面":平台客服介入处理的截图。
    "外部APP截图":各种非淘宝、菜鸟APP的截图，包括京东、拼多多、短信、手机系统截图。
    "其他类别图片":拿不准的其他图片。

# 现在,请你根据图片中的信息逐步推理得到分类标签。
'''
```

## 各个类的response设计：

#### 商品分类选项 

定义：图片中显示商品颜色、规格选项
训练集中共有39个样本


信息提取prompt设计：
```python
prompt = '''
# 你是一个电商领域识图专家,可以理解消费者上传的软件截图或实物拍摄图。

# 你的任务是: 
    首先用一句话概括图片，之后将图片中的文字信息以简洁的描述方式呈现，避免冗长的解释，仅列出最重要和明显的细节。

# 消费者上传的图片如下所示:

'''
```

感觉效果不是很好，是能给出图片中的信息，但是不能给出特定的信息，他会将几乎所有信息都呈现出来，这样没有区分度啊.
感觉需要对模型做一个微调。让他能够针对于不同的图片给出关键的信息，而非整体的信息。



感觉在prompt中加入一个对于类别的解释。
```python
## 感觉需要让vlm自己来解释为什么属于这个类，自己设计有点不太好设计啊
#手工设计的
response_1 = '''
##手工设计的
这是一张{xx}的购买页面的截图,主要显示了可以选择的商品的规格：xxxx，颜色:xxxx。 由于主要信息符合类别"商品分类选项"的定义："图片中显示商品颜色、规格选项",
因此 标签为: "商品分类选项".
'''

##qwen-vl-72b模型解释
response_2='''
"这张图片显示的是一个商品的购买页面,包含了商品的价格、规格选项、数量选择以及服务保障等信息。符合类别"商品分类选项"的定义,因此，这张图片的分类标签是"商品分类选项"。
'''

##人工在qwen-vl-72b上加上对原因解释的格式要求：

response_3='''"这张图片显示的是xxxx页面,包含了xxxx等信息。符合类别"xxxx"的定义:"xxxx",因此，这张图片的分类标签是"xxxx"。

## 类别
check_str = "商品分类选项"

## prompt再设计
prompt = """
# 你是一个电商领域识图专家,可以理解消费者上传的软件截图或实物拍摄图。 

# 上传的图片属于如下的分类标签中的一类:
    [\"实物拍摄(含售后)\",\"商品分类选项\",\"商品头图\",\"商品详情页截图\",\"下单过程中出现异常（显示购买失败浮窗）\",\"订单详情页面\",\"支付页面\",\"评论区截图页面\",\"物流页面-物流列表页面\",\"物流页面-物流跟踪页面\",\"物流页面-物流异常页面\",\"退款页面\",\"退货页面\",\"换货页面\",\"购物车页面\",\"店铺页面\",\"活动页面\",\"优惠券领取页面\",\"账单/账户页面\",\"投诉举报页面\",\"平台介入页面\",\"外部APP截图\",\"其他类别图片\"]

# 各个标签的定义如下：
    "实物拍摄(含售后)":用户用相机实拍的照片，包括用户售后的照片（损坏、缺失、与描述不符），或者其他用相机实拍的图片。
    "商品分类选项":商品颜色、规格选项。
    "商品头图":商品首页大图。
    "商品详情页截图":可能出现在商品详情页各个部分的截图。
    "下单过程中出现异常（显示购买失败浮窗）":下单过程中出现异常（显示购买失败浮窗）的截图。
    "订单详情页面":呈现出完整订单信息的订单页面。
    "支付页面":包含支付方式选择、支付成功的页面。
    "评论区截图页面":在淘宝APP内或其他APP内的评论区截图。
    "物流页面-物流列表页面":呈现出两个以上物流信息的页面。
    "物流页面-物流跟踪页面":呈现出物流运输路径的页面。
    "物流页面-物流异常页面":包含物流异常信息的页面。
    "退款页面":含有退款信息的页面。
    "退货页面":含有退货信息的页面。
    "换货页面":含有换货信息的页面。
    "购物车页面":淘宝购物车页面的列表图或金额计算图。
    "店铺页面":店铺首页截图。
    "活动页面":活动截图。
    "优惠券领取页面":店铺首页或活动页中领取优惠券的截图。
    "账单/账户页面":包含交易明细列表、资产列表、卡券红包列表等。
    "投诉举报页面":	投诉或举报页面。
    "实物拍摄(含售后)":用户用相机实拍的照片，包括用户售后的照片（损坏、缺失、与描述不符），或者其他用相机实拍的图片。
    "平台介入页面":平台客服介入处理的截图。
    "外部APP截图":各种非淘宝、菜鸟APP的截图，包括京东、拼多多、短信、手机系统截图。
    "其他类别图片":拿不准的其他图片。

# 现在,请你根据图片中的信息以及类别标签的定义,按如下推理步骤解释这张图片的分类标签为"{}"的原因。
    推理步骤：
    这张图片显示的是xxxx页面,包含了xxxx等信息。符合类别"xxxx"的定义:"xxxx",因此，这张图片的分类标签是"xxxx
""".format(check_str)
```

