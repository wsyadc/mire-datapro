# mire-datapro

利用qwen-vl-72b处理图片场景识别中的数据，
共有23个类，700个样本。

## 数据分析需求

设计了三个prompt得到三个组数据，分别存储在 train/reasonbyQwen72b_modeli  i取1,2,3，分别对应三种不同的promot。

prompt设计请看mire-datapro/TrainSet_Enhancement/Qwen_72B_class_reason_para.py 文件中的内容。
简单来说，1、模型自由推理(不给模型类别信息)，要求推理格式。2、给出图片类别信息，要求推理格式，3、给出图片类别信息并要求模型推理字数在100以内，要求推理格式。
三种prompt模式是为了对比分析数据，第三类 给出图片类别信息，并要求模型推理字数在100字以内，要求推理格式，是我们会在上面进行修改样本的"output"最终作为训练集的。
可以看到的是从1到2到3,给出的信息变多，此外，要求变多，希望能通过对比三类去分析数据特性，
1、是作为一个baseline，
2、是在prompt中给出了图片的类别信息，但是发现，即使给出类别信息，模型的推理也会出现推理结果不正确的情况，希望能通过分析数据看一下是哪里的问题:
  (1)是否是我们在prompt中给出的各个类别的定义(来自官网)是相互之间有交集的，导致模型判断失败,如果是这样，我们需要更新prompt中23个类的定义，而非使用官方给出的。
  (2)是不是数据集本身有问题？，是否有必要对训练集进行一个清洗。
  (3)qwen-vl-max模型分析能力不足？那就不管了。
希望能通过总结分析各个类中推理失败的情况来得出结论。
3、相较于2而言，我们在3中添加了字数的约束(告知模型输出推理字数在100字以内)，这里也会出现即使给出类别信息，模型推理也会报错的情况，主要对比一下的是，在添加上字数约束之后，
  对于推理结果影响。是更好，还是更坏。

我们会在3这个prompt模式的基础上做人工手动标注修改不正确的response，作为修正的训练集。

你应该将reasonbyQwen72b_model i 三个文件夹放在你的train目录下.

## 运行
我是在windows下处理的，

如果想自己推理，或者修改prompt自己推理：

TrainSet_Enhancement这个文件夹最好放和train同级目录(不放也行，因为我基本用的都是绝对路径)

TrainSet_Enhancement里面，call_classreason_1.sh这个脚本调用Qwen_72B_class_reason_para.py这个python文件，以批量生成推理结果。

由于可能推理会被中断，不如
在换货这个类中：9e2a1ebe-87c3-4547-b405-b592aabfdab-1384 这条含有不当内容处理不了(推理模式1情况下),当前保存的三个文件夹中都不含有这个样本.

Qwen_72B_class_reason.py是Qwen_72B_class_reason_para.py的单类版本，你可以直接运行输入，类别(输入的类别不一定是全名，有些带括号什么的我直接删了，可以和我的命名同步)   和 prompt模式。

记得修改绝对路径


## 附加物
qwen72B_enhance.py 之前做的对图片场景分类的700个样本做了信息提取。
结果我新建了一个文件夹放在 mire-datapro/train/info_ectra 下
分类7个json文件，每个里面有100个。
